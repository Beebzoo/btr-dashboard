<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BTR Dashboard - Maastricht Science Programme</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Verdana', Arial, sans-serif;
            background: #ffffff;
            color: #333;
            line-height: 1.6;
        }

        /* Header Styles */
        .header {
            background: white;
            color: #001C3D;
            padding: 15px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            color: #001C3D;
        }

        .logo img {
            height: 60px;
        }

        .logo-text {
            font-size: 18px;
            font-weight: 600;
            color: #001C3D;
        }

        .nav-menu {
            display: flex;
            gap: 30px;
            align-items: center;
        }

        .nav-menu a {
            color: #001C3D;
            text-decoration: none;
            font-size: 14px;
            transition: color 0.3s;
        }

        .nav-menu a:hover {
            color: #00A2DB;
        }

        .my-um-btn {
            background: #001C3D;
            color: white;
            padding: 8px 20px;
            border-radius: 4px;
            font-weight: 600;
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, #002D5A 0%, #001C3D 100%);
            color: white;
            padding: 80px 30px;
            text-align: center;
        }

        .hero h1 {
            font-size: 48px;
            margin-bottom: 20px;
            font-weight: 700;
        }

        .hero p {
            font-size: 20px;
            margin-bottom: 40px;
            opacity: 0.95;
        }

        .cohort-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .cohort-btn {
            background: #00BCD4;
            color: white;
            padding: 15px 40px;
            border-radius: 6px;
            text-decoration: none;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            border: 2px solid #00BCD4;
        }

        .cohort-btn:hover {
            background: #00ACC1;
            transform: translateY(-2px);
        }

        .cohort-btn.secondary {
            background: transparent;
            border: 2px solid white;
        }

        .cohort-btn.secondary:hover {
            background: rgba(255,255,255,0.1);
        }

        /* Main Content */
        .content-wrapper {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 30px;
            display: flex;
            gap: 40px;
        }

        .sidebar {
            width: 280px;
            flex-shrink: 0;
        }

        .sidebar h3 {
            font-size: 14px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 15px;
        }

        .sidebar-nav {
            background: transparent;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: none;
        }

        .sidebar-nav a {
            display: block;
            padding: 15px 20px;
            color: #333;
            text-decoration: none;
            border-left: 3px solid transparent;
            transition: all 0.3s;
        }

        .sidebar-nav a:hover,
        .sidebar-nav a.active {
            background: #E6F7FF;
            border-left-color: #00BCD4;
            color: #001C3D;
        }

        .main-content {
            flex: 1;
        }

        .info-section {
            background: transparent;
            padding: 40px;
            border-radius: 8px;
            margin-bottom: 40px;
            box-shadow: none;
        }

        .info-section h2 {
            font-size: 28px;
            color: #001C3D;
            margin-bottom: 20px;
        }

        .info-section h3 {
            font-size: 22px;
            color: #002D5A;
            margin-top: 30px;
            margin-bottom: 15px;
        }

        .info-section p {
            margin-bottom: 15px;
            font-size: 16px;
            line-height: 1.8;
        }

        /* Platform Boxes */
        .platform-boxes {
            display: flex;
            flex-direction: column;
            gap: 30px;
            margin: 40px 0;
        }

        .platform-box {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .platform-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.12);
        }

        .platform-link {
            display: block;
            padding: 30px;
            text-decoration: none;
            color: white;
            font-size: 24px;
            font-weight: 700;
            text-align: center;
            transition: opacity 0.3s;
        }

        .platform-link:hover {
            opacity: 0.9;
        }

        .platform-box.collent .platform-link {
            background: linear-gradient(135deg, #00BCD4 0%, #00ACC1 100%);
        }

        .platform-box.canvas .platform-link {
            background: linear-gradient(135deg, #FF6200 0%, #E55A00 100%);
        }

        .platform-box.intranet .platform-link {
            background: linear-gradient(135deg, #002D5A 0%, #001C3D 100%);
        }

        .platform-info {
            padding: 0;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-out, padding 0.4s ease-out;
        }

        .platform-info.active {
            max-height: 2000px;
            padding: 30px;
            transition: max-height 0.5s ease-in, padding 0.5s ease-in;
        }

        .info-toggle {
            background: #f8f9fa;
            padding: 15px 30px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            color: #002D5A;
            transition: background 0.3s;
            border-top: 1px solid #e0e0e0;
        }

        .info-toggle:hover {
            background: #e9ecef;
        }

        .info-toggle .arrow {
            font-size: 20px;
            transition: transform 0.3s;
        }

        .info-toggle.active .arrow {
            transform: rotate(180deg);
        }

        .platform-info h4 {
            color: #002D5A;
            font-size: 18px;
            margin-top: 20px;
            margin-bottom: 10px;
        }

        .platform-info h4:first-child {
            margin-top: 0;
        }

        .platform-info ul {
            margin-left: 20px;
            margin-bottom: 15px;
        }

        .platform-info li {
            margin-bottom: 8px;
            font-size: 15px;
            line-height: 1.6;
        }

        .platform-info strong {
            color: #001C3D;
        }

        /* Subsection Toggle */
        .subsection-toggle {
            background: #f8f9fa;
            padding: 12px 15px;
            margin: 10px 0;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            color: #002D5A;
            transition: background 0.3s;
            border-left: 3px solid #00BCD4;
        }

        .subsection-toggle:hover {
            background: #e9ecef;
        }

        .subsection-toggle .sub-arrow {
            font-size: 16px;
            transition: transform 0.3s;
        }

        .subsection-toggle.active .sub-arrow {
            transform: rotate(180deg);
        }

        .subsection-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            margin-left: 15px;
        }

        .subsection-content.active {
            max-height: 1000px;
            transition: max-height 0.4s ease-in;
        }

        .warning-text {
            background: #FFF3E0;
            border-left: 4px solid #FF6200;
            padding: 15px;
            margin-top: 15px;
            border-radius: 4px;
            font-weight: 600;
            color: #FF6200;
        }

        /* Timeline Section */
        .timeline-section {
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .timeline-section h2 {
            font-size: 32px;
            color: #001C3D;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 3px solid #00BCD4;
        }

        .timeline-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }

        .timeline-item {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 8px;
            border-left: 4px solid #00BCD4;
        }

        .timeline-date {
            font-size: 18px;
            color: #00BCD4;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .timeline-title {
            font-size: 20px;
            color: #001C3D;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .timeline-desc {
            font-size: 15px;
            color: #666;
        }

        /* Footer - FIXED FOR FULL WIDTH */
        .footer {
            background: #002D5A;
            color: white;
            padding: 40px 0;
            margin-top: 60px;
            text-align: center;
            width: 100%;
        }

        .footer-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 30px;
        }

        .footer p {
            margin: 10px 0;
        }

        .footer a {
            color: #00BCD4;
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        /* Easter Egg Circle */
        .easter-egg {
            position: absolute;
            bottom: 20px;
            right: 30px;
            width: 20px;
            height: 20px;
            background: #E84E10;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
            opacity: 0.6;
        }

        .easter-egg:hover {
            opacity: 1;
            transform: scale(1.2);
        }

        /* Game Overlay */
        .game-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 28, 61, 0.95);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .game-overlay.active {
            display: flex;
        }

        .game-container {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }

        .game-canvas {
            border: 3px solid #001C3D;
            display: block;
            background: #fff;
            border-radius: 4px;
        }

        .game-info {
            color: white;
            text-align: center;
            margin-bottom: 20px;
        }

        .game-info h2 {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .game-score {
            font-size: 18px;
            color: #00BCD4;
            margin-top: 10px;
        }

        .close-game {
            color: white;
            text-align: center;
            margin-top: 15px;
            font-size: 14px;
            opacity: 0.8;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .content-wrapper {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
            }
        }

        @media (max-width: 768px) {
            .hero h1 {
                font-size: 36px;
            }

            .nav-menu {
                display: none;
            }

            .game-canvas {
                width: 95%;
                max-width: 400px;
                height: auto;
            }

            .game-info h2 {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <a href="index.html" class="logo">
                <img src="msp-logo.jpg" alt="MSP Logo">
                <span class="logo-text">Maastricht Science Programme</span>
            </a>
            <nav class="nav-menu">
                <a href="https://collent-fsemsp.maastrichtuniversity.nl/FSE_MSP/Home/Dashboard" target="_blank">Collent</a>
                <a href="https://canvas.maastrichtuniversity.nl/" target="_blank">Canvas</a>
                <a href="https://intranet.maastrichtuniversity.nl/msp" target="_blank">Intranet</a>
                <a href="mailto:msp-btr@maastrichtuniversity.nl">Contact</a>
                <a href="https://my.maastrichtuniversity.nl" target="_blank" class="my-um-btn">My UM</a>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <h1>Bachelor Thesis Research</h1>
        <p>Welcome to the Bachelor Thesis Research Dashboard.</p>
        <div class="cohort-buttons">
            <a href="#september" class="cohort-btn">September Cohort â†’</a>
            <a href="#february" class="cohort-btn secondary">February Cohort â†’</a>
        </div>
    </section>

    <!-- Main Content -->
    <div class="content-wrapper">
        <!-- Sidebar -->
        <aside class="sidebar">
            <h3>Bachelor Thesis Research</h3>
            <nav class="sidebar-nav">
                <a href="before-you-start.html">Before you Start the BTR</a>
                <a href="#">Timelines</a>
                <a href="writing-the-proposal.html">Writing the Proposal</a>
                <a href="writing-the-thesis.html">Writing the Thesis</a>
                <a href="btr-video.html">Making the BTR Video</a>
                <a href="faq.html">Frequently Asked Questions</a>
                <a href="#">Rubrics</a>
            </nav>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Info Section -->
            <div class="info-section">
                <h2>The Final Step of Your MSP Journey</h2>
                <p>The Bachelor Thesis Research (BTR) is a one-semester, 30 ECTS research project that marks the completion of your Maastricht Science Programme degree. This is where you bring together everything you've learned and demonstrate your growth as an independent researcher.</p>

                <h3>What is the BTR?</h3>
                <p>During your BTR, you'll conduct high-level academic research in a scientific area of your choosing. You'll experience the complete scientific cycle: formulating research questions, designing experiments, analyzing results, and communicating your findings. You can work with MSP faculty in Maastricht, at other institutions in the Netherlands, or abroad.</p>

                <h3>Why the BTR matters</h3>
                <p>The BTR prepares you for the real world of scientific research. You'll work with strict deadlines, take full responsibility for your project, and develop the independence needed for a research master's programme or a career in science. This is your opportunity to specialize, contribute to ongoing research, and show what you're capable of.</p>

                <h3>Everything you need is here</h3>
                <p>This website guides you through the entire BTR process. Find information about requirements and deadlines, prepare your application, access important forms, and get answers to your questions. Whether you're exploring options or ready to apply, we're here to support you.</p>
            </div>

            <!-- Platform Boxes -->
            <div class="platform-boxes">
                <!-- Collent Box -->
                <div class="platform-box collent">
                    <a href="https://collent-fsemsp.maastrichtuniversity.nl/FSE_MSP/Home/Dashboard" target="_blank" class="platform-link">
                        Collent
                    </a>
                    <div class="info-toggle" onclick="toggleInfo(this)">
                        <span>What can I find here?</span>
                        <span class="arrow">â–¼</span>
                    </div>
                    <div class="platform-info">
                        <div class="subsection-toggle" onclick="toggleSubsection(this)">
                            <span>1. Submit Request to Start (RTS)</span>
                            <span class="sub-arrow">â–¼</span>
                        </div>
                        <div class="subsection-content">
                            <ul>
                                <li>Upload proof of correspondence with supervisor</li>
                                <li>Upload brief thesis description (Â½ page)</li>
                                <li>Note if taking additional module</li>
                            </ul>
                        </div>

                        <div class="subsection-toggle" onclick="toggleSubsection(this)">
                            <span>2. Submit All BTR Components</span>
                            <span class="sub-arrow">â–¼</span>
                        </div>
                        <div class="subsection-content">
                            <ul>
                                <li>Proposal (max 10MB)</li>
                                <li>Midterm Practical Work form</li>
                                <li>Final Thesis (max 25MB)</li>
                                <li>Final Practical Work form</li>
                                <li>Video submission (WeTransfer link + consent form)</li>
                            </ul>
                        </div>

                        <div class="subsection-toggle" onclick="toggleSubsection(this)">
                            <span>3. View Internal Advisor Assignment</span>
                            <span class="sub-arrow">â–¼</span>
                        </div>
                        <div class="subsection-content">
                            <ul>
                                <li>Can see who their IA is once assigned</li>
                            </ul>
                        </div>

                        <div class="subsection-toggle" onclick="toggleSubsection(this)">
                            <span>4. Peer Review Video</span>
                            <span class="sub-arrow">â–¼</span>
                        </div>
                        <div class="subsection-content">
                            <ul>
                                <li>Access assigned peer's video</li>
                                <li>Submit peer review assessment</li>
                            </ul>
                        </div>

                        <div class="subsection-toggle" onclick="toggleSubsection(this)">
                            <span>5. Track Submission Status</span>
                            <span class="sub-arrow">â–¼</span>
                        </div>
                        <div class="subsection-content">
                            <ul>
                                <li>See which assignments are outstanding</li>
                                <li>Automatic deadline reminders</li>
                            </ul>
                        </div>

                        <p style="margin-top: 20px;"><strong>File Naming:</strong> Name_IDNumber_DocumentType (e.g., AbedNadir_i612345_Proposal)</p>
                    </div>
                </div>

                <!-- Canvas Box -->
                <div class="platform-box canvas">
                    <a href="https://canvas.maastrichtuniversity.nl/" target="_blank" class="platform-link">
                        Canvas
                    </a>
                    <div class="info-toggle" onclick="toggleInfo(this)">
                        <span>What can I find here?</span>
                        <span class="arrow">â–¼</span>
                    </div>
                    <div class="platform-info">
                        <div class="subsection-toggle" onclick="toggleSubsection(this)">
                            <span>1. View All Grades & Feedback</span>
                            <span class="sub-arrow">â–¼</span>
                        </div>
                        <div class="subsection-content">
                            <ul>
                                <li>Proposal grades + rubrics</li>
                                <li>Midterm practical grades</li>
                                <li>Final thesis grades + rubrics</li>
                                <li>Final practical grades</li>
                                <li>Video grades + rubrics</li>
                                <li>Detailed feedback from RS and IA</li>
                            </ul>
                        </div>

                        <div class="subsection-toggle" onclick="toggleSubsection(this)">
                            <span>2. Access BTR Documents</span>
                            <span class="sub-arrow">â–¼</span>
                        </div>
                        <div class="subsection-content">
                            <ul>
                                <li><strong>General Information folder:</strong>
                                    <ul>
                                        <li>Checklist to start BTR</li>
                                        <li>BTR Information Presentation</li>
                                        <li>BTR information booklet</li>
                                    </ul>
                                </li>
                                <li><strong>IRO Information folder:</strong>
                                    <ul>
                                        <li>Emergency contact form</li>
                                        <li>Erasmus grant application form</li>
                                        <li>Useful IRO links</li>
                                    </ul>
                                </li>
                                <li><strong>Possible Research Opportunities folder:</strong>
                                    <ul>
                                        <li>Research areas of MSP staff</li>
                                        <li>External thesis opportunities</li>
                                        <li>Potential supervisor information</li>
                                    </ul>
                                </li>
                            </ul>
                        </div>

                        <div class="subsection-toggle" onclick="toggleSubsection(this)">
                            <span>3. Guidelines & Resources</span>
                            <span class="sub-arrow">â–¼</span>
                        </div>
                        <div class="subsection-content">
                            <ul>
                                <li>Proposal guidelines</li>
                                <li>Written thesis guidelines</li>
                                <li>Video guidelines</li>
                                <li>Grading rubrics for all components</li>
                                <li>BTR handbook</li>
                                <li>FAQ document</li>
                            </ul>
                        </div>

                        <div class="subsection-toggle" onclick="toggleSubsection(this)">
                            <span>4. Announcements</span>
                            <span class="sub-arrow">â–¼</span>
                        </div>
                        <div class="subsection-content">
                            <ul>
                                <li>Important BTR updates</li>
                                <li>Deadline reminders</li>
                                <li>Policy changes</li>
                            </ul>
                        </div>

                        <div class="warning-text">
                            Canvas is ONLY for viewing/downloading - NO submissions!
                        </div>
                    </div>
                </div>

                <!-- Intranet Box -->
                <div class="platform-box intranet">
                    <a href="https://intranet.maastrichtuniversity.nl/msp" target="_blank" class="platform-link">
                        Intranet
                    </a>
                    <div class="info-toggle" onclick="toggleInfo(this)">
                        <span>What can I find here?</span>
                        <span class="arrow">â–¼</span>
                    </div>
                    <div class="platform-info">
                        <div class="subsection-toggle" onclick="toggleSubsection(this)">
                            <span>Additional Module Request Form</span>
                            <span class="sub-arrow">â–¼</span>
                        </div>
                        <div class="subsection-content">
                            <ul>
                                <li>Must be submitted <strong>BEFORE</strong> Course Registration deadline</li>
                                <li>Required if taking module alongside BTR</li>
                                <li>Needs BoE approval before registering</li>
                                <li>Only allowed for BTR in/near Maastricht (not abroad)</li>
                                <li>Maximum <strong>ONE</strong> additional module during entire BTR</li>
                                <li>Must also note on RTS form in Collent</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Footer - UPDATED STRUCTURE -->
    <footer class="footer">
        <div class="footer-content">
            <p><strong>Questions about the BTR?</strong> Contact the BTR Office: msp-btr@maastrichtuniversity.nl</p>
            <p style="margin-top: 20px;">
                <a href="writing-the-proposal.html">Proposal Guidelines</a> | 
                <a href="writing-the-thesis.html">Thesis Guidelines</a> | 
                <a href="btr-video.html">Video Guidelines</a> | 
                <a href="mailto:msp-btr@maastrichtuniversity.nl">Contact</a>
            </p>
            <p style="margin-top: 15px; font-size: 12px; opacity: 0.8;">
                Â© Maastricht University - Faculty of Science and Engineering
            </p>
        </div>
        <!-- Easter Egg Circle -->
        <div class="easter-egg" id="easterEgg" onclick="easterEggClick()"></div>
    </footer>

    <!-- Game Overlay -->
    <div class="game-overlay" id="gameOverlay">
        <div class="game-info">
            <h2>ðŸŽ“ BTR Thesis Runner!</h2>
            <p>Press SPACE or â†‘ to jump | Press â†“ to duck tassel | Press ESC to exit</p>
            <div class="game-score">Score: <span id="gameScore">0</span> | High Score: <span id="highScore">0</span></div>
        </div>
        <div class="game-container">
            <canvas id="gameCanvas" class="game-canvas" width="1600" height="400"></canvas>
        </div>
        <p class="close-game">Press ESC to return to dashboard</p>
    </div>

    <script>
        function toggleInfo(element) {
            const infoDiv = element.nextElementSibling;
            const isActive = infoDiv.classList.contains('active');
            
            // Toggle active class
            element.classList.toggle('active');
            infoDiv.classList.toggle('active');
        }

        function toggleSubsection(element) {
            const contentDiv = element.nextElementSibling;
            
            // Toggle active class
            element.classList.toggle('active');
            contentDiv.classList.toggle('active');
        }

        // Easter Egg Activation
        let clickCount = 0;
        let clickTimer = null;

        function easterEggClick() {
            clickCount++;
            
            if (clickTimer) clearTimeout(clickTimer);
            
            if (clickCount === 3) {
                startGame();
                clickCount = 0;
            } else {
                clickTimer = setTimeout(() => {
                    clickCount = 0;
                }, 1000);
            }
        }

        // Game Variables
        let canvas, ctx;
        let gameRunning = false;
        let score = 0;
        let highScore = localStorage.getItem('btrHighScore') || 0;
        let player, obstacles, flyingBoxes, gameSpeed, gravity;
        let animationFrame = 0;
        let clouds = [];

        function startGame() {
            document.getElementById('gameOverlay').classList.add('active');
            canvas = document.getElementById('gameCanvas');
            ctx = canvas.getContext('2d');
            
            // Initialize game
            score = 0;
            gameSpeed = 10;
            gravity = 1.0;
            obstacles = [];
            flyingBoxes = [];
            animationFrame = 0;
            
            // Initialize clouds
            clouds = [
                { x: 200, y: 50, size: 60, speed: 0.3 },
                { x: 500, y: 80, size: 80, speed: 0.2 },
                { x: 900, y: 40, size: 70, speed: 0.25 },
                { x: 1300, y: 70, size: 65, speed: 0.28 }
            ];
            
            player = {
                x: 100,
                y: 280,
                width: 35,
                height: 45,
                normalHeight: 45,
                duckHeight: 25,
                velocityY: 0,
                jumping: false,
                ducking: false,
                legPhase: 0
            };
            
            document.getElementById('gameScore').textContent = score;
            document.getElementById('highScore').textContent = highScore;
            
            gameRunning = true;
            gameLoop();
            
            // Add keyboard controls
            document.addEventListener('keydown', handleKeyPress);
            document.addEventListener('keyup', handleKeyUp);
        }

        function handleKeyPress(e) {
            // Jump with Space or ArrowUp
            if ((e.code === 'Space' || e.code === 'ArrowUp') && !player.jumping && gameRunning) {
                e.preventDefault();
                player.velocityY = -17;
                player.jumping = true;
                player.ducking = false;
                player.height = player.normalHeight;
            }
            
            // Duck with ArrowDown (ducks the tassel)
            if (e.code === 'ArrowDown' && gameRunning) {
                e.preventDefault();
                player.ducking = true;
            }
            
            if (e.code === 'Escape') {
                closeGame();
            }
        }

        function handleKeyUp(e) {
            // Stop ducking when down arrow is released
            if (e.code === 'ArrowDown' && player.ducking && gameRunning) {
                player.ducking = false;
            }
        }

        function closeGame() {
            document.getElementById('gameOverlay').classList.remove('active');
            gameRunning = false;
            obstacles = [];
            flyingBoxes = [];
            document.removeEventListener('keydown', handleKeyPress);
            document.removeEventListener('keyup', handleKeyUp);
        }

        function drawSun() {
            // Sun
            ctx.fillStyle = '#FFD700';
            ctx.beginPath();
            ctx.arc(1450, 80, 40, 0, Math.PI * 2);
            ctx.fill();
            
            // Sun rays
            ctx.strokeStyle = '#FFD700';
            ctx.lineWidth = 3;
            for (let i = 0; i < 8; i++) {
                let angle = (Math.PI * 2 / 8) * i;
                ctx.beginPath();
                ctx.moveTo(1450 + Math.cos(angle) * 50, 80 + Math.sin(angle) * 50);
                ctx.lineTo(1450 + Math.cos(angle) * 65, 80 + Math.sin(angle) * 65);
                ctx.stroke();
            }
        }

        function drawCloud(x, y, size) {
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            
            // Cloud circles
            ctx.beginPath();
            ctx.arc(x, y, size * 0.5, 0, Math.PI * 2);
            ctx.arc(x + size * 0.4, y - size * 0.1, size * 0.4, 0, Math.PI * 2);
            ctx.arc(x + size * 0.8, y, size * 0.5, 0, Math.PI * 2);
            ctx.arc(x + size * 0.4, y + size * 0.2, size * 0.45, 0, Math.PI * 2);
            ctx.fill();
        }

        function gameLoop() {
            if (!gameRunning) return;
            
            animationFrame++;
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw blue sky gradient
            let gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#87CEEB'); // Sky blue
            gradient.addColorStop(0.7, '#B0E0E6'); // Lighter blue
            gradient.addColorStop(1, '#fff');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw sun
            drawSun();
            
            // Update and draw clouds
            for (let cloud of clouds) {
                cloud.x -= cloud.speed;
                if (cloud.x + cloud.size < 0) {
                    cloud.x = canvas.width + cloud.size;
                }
                drawCloud(cloud.x, cloud.y, cloud.size);
            }
            
            // Draw score at top
            ctx.fillStyle = '#001C3D';
            ctx.font = 'bold 28px Arial';
            ctx.textAlign = 'left';
            ctx.fillText('Score: ' + score, 30, 50);
            ctx.font = '18px Arial';
            ctx.fillText('Speed: ' + gameSpeed.toFixed(1) + 'x', 30, 80);
            
            // Draw ground
            ctx.fillStyle = '#4CAF50';
            ctx.fillRect(0, 380, canvas.width, 20);
            
            // Update player physics
            player.velocityY += gravity;
            player.y += player.velocityY;
            
            // Ground collision
            if (player.y > 330 - player.height + player.normalHeight) {
                player.y = 330 - player.height + player.normalHeight;
                player.velocityY = 0;
                player.jumping = false;
            } else if (player.y > 310 && player.velocityY > 0) {
                player.velocityY *= 1.1;
            }
            
            // Draw player body (BTR book)
            ctx.fillStyle = '#E84E10';
            ctx.fillRect(player.x, player.y, player.width, player.height);
            ctx.fillStyle = '#fff';
            ctx.fillRect(player.x + 3, player.y + 3, player.width - 6, player.height - 6);
            ctx.fillStyle = '#001C3D';
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('BTR', player.x + player.width/2, player.y + player.height/2 + 5);

            // Draw animated legs
            if (!player.jumping) {
                let legCycle = Math.floor(animationFrame / 5) % 4;
                player.legPhase = legCycle;
                
                ctx.fillStyle = '#001C3D';
                ctx.lineWidth = 3;
                
                // Left leg
                let leftLegOffset = 0;
                if (legCycle === 0) leftLegOffset = -3;
                if (legCycle === 1) leftLegOffset = 0;
                if (legCycle === 2) leftLegOffset = 3;
                if (legCycle === 3) leftLegOffset = 0;
                
                ctx.beginPath();
                ctx.moveTo(player.x + player.width/2 - 5, player.y + player.height);
                ctx.lineTo(player.x + player.width/2 - 5 + leftLegOffset, player.y + player.height + 12);
                ctx.strokeStyle = '#001C3D';
                ctx.stroke();
                
                // Right leg
                let rightLegOffset = 0;
                if (legCycle === 0) rightLegOffset = 3;
                if (legCycle === 1) rightLegOffset = 0;
                if (legCycle === 2) rightLegOffset = -3;
                if (legCycle === 3) rightLegOffset = 0;
                
                ctx.beginPath();
                ctx.moveTo(player.x + player.width/2 + 5, player.y + player.height);
                ctx.lineTo(player.x + player.width/2 + 5 + rightLegOffset, player.y + player.height + 12);
                ctx.stroke();
                
                // Feet
                ctx.fillStyle = '#001C3D';
                ctx.fillRect(player.x + player.width/2 - 5 + leftLegOffset - 3, player.y + player.height + 12, 6, 3);
                ctx.fillRect(player.x + player.width/2 + 5 + rightLegOffset - 3, player.y + player.height + 12, 6, 3);
            }

            // Draw graduation cap - TASSEL STARTS UP
            let capX = player.x + player.width/2;
            let capY = player.y - 12;

            // Cap base (square top)
            ctx.fillStyle = '#001C3D';
            ctx.fillRect(capX - 16, capY - 4, 32, 4);

            // Cap top (mortarboard)
            ctx.beginPath();
            ctx.moveTo(capX - 14, capY);
            ctx.lineTo(capX + 14, capY);
            ctx.lineTo(capX + 16, capY - 3);
            ctx.lineTo(capX - 16, capY - 3);
            ctx.closePath();
            ctx.fill();

            // Tassel - UP by default, DOWN when ducking
            let tasselStartY = capY - 1;
            let tasselEndY = player.ducking ? capY + 10 : capY - 15; // UP when not ducking, DOWN when ducking
            
            ctx.strokeStyle = '#00BCD4';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(capX + 11, tasselStartY);
            ctx.lineTo(capX + 16, tasselEndY);
            ctx.stroke();

            // Tassel tip
            ctx.fillStyle = '#00BCD4';
            ctx.beginPath();
            ctx.arc(capX + 16, tasselEndY, 3, 0, Math.PI * 2);
            ctx.fill();
            
            // Store tassel position for collision detection
            let tasselX = capX + 16;
            let tasselY = tasselEndY;
            let tasselRadius = 3;
            
            // Spawn DNA strand obstacles
            let baseMinSpacing = 280;
            let baseMaxSpacing = 600;
            let speedScaling = gameSpeed * 35;
            
            let minSpacing = baseMinSpacing + speedScaling;
            let maxSpacing = baseMaxSpacing + speedScaling;
            
            let randomRange = Math.random() * (maxSpacing - minSpacing);
            let targetSpacing = minSpacing + randomRange;
            
            if (obstacles.length === 0 || obstacles[obstacles.length - 1].x < canvas.width - targetSpacing) {
                let dnaHeight = 40 + Math.floor(Math.random() * 35);
                obstacles.push({
                    x: canvas.width,
                    y: 380 - dnaHeight,
                    width: 35,
                    height: dnaHeight
                });
            }
            
            // Update and draw DNA obstacles
            for (let i = obstacles.length - 1; i >= 0; i--) {
                let dna = obstacles[i];
                dna.x -= gameSpeed;
                
                // Draw DNA double helix
                let centerX = dna.x + dna.width / 2;
                let dnaWidth = 25;
                let segments = 8;
                let segmentHeight = dna.height / segments;

                ctx.lineWidth = 3;
                ctx.strokeStyle = '#00BCD4';
                ctx.beginPath();
                for (let j = 0; j <= segments; j++) {
                    let y = dna.y + (j * segmentHeight);
                    let offsetX = Math.sin(j * 0.8) * (dnaWidth / 2);
                    if (j === 0) {
                        ctx.moveTo(centerX + offsetX, y);
                    } else {
                        ctx.lineTo(centerX + offsetX, y);
                    }
                }
                ctx.stroke();

                ctx.strokeStyle = '#E84E10';
                ctx.beginPath();
                for (let j = 0; j <= segments; j++) {
                    let y = dna.y + (j * segmentHeight);
                    let offsetX = Math.sin(j * 0.8 + Math.PI) * (dnaWidth / 2);
                    if (j === 0) {
                        ctx.moveTo(centerX + offsetX, y);
                    } else {
                        ctx.lineTo(centerX + offsetX, y);
                    }
                }
                ctx.stroke();

                ctx.strokeStyle = '#666';
                ctx.lineWidth = 2;
                for (let j = 0; j < segments; j++) {
                    let y = dna.y + (j * segmentHeight) + (segmentHeight / 2);
                    let x1 = centerX + Math.sin(j * 0.8 + (segmentHeight / (2 * segmentHeight))) * (dnaWidth / 2);
                    let x2 = centerX + Math.sin(j * 0.8 + Math.PI + (segmentHeight / (2 * segmentHeight))) * (dnaWidth / 2);
                    
                    ctx.beginPath();
                    ctx.moveTo(x1, y);
                    ctx.lineTo(x2, y);
                    ctx.stroke();
                    
                    ctx.fillStyle = '#00BCD4';
                    ctx.beginPath();
                    ctx.arc(x1, y, 3, 0, Math.PI * 2);
                    ctx.fill();
                    
                    ctx.fillStyle = '#E84E10';
                    ctx.beginPath();
                    ctx.arc(x2, y, 3, 0, Math.PI * 2);
                    ctx.fill();
                }
                
                // Collision with DNA
                if (player.x < dna.x + dna.width &&
                    player.x + player.width > dna.x &&
                    player.y < dna.y + dna.height &&
                    player.y + player.height > dna.y) {
                    gameOver();
                    return;
                }
                
                // Remove off-screen obstacles
                if (dna.x + dna.width < 0) {
                    obstacles.splice(i, 1);
                    score++;
                    document.getElementById('gameScore').textContent = score;
                    
                    if (score % 3 === 0) {
                        gameSpeed += 0.5;
                    }
                }
            }
            
            // Spawn flying boxes ONLY after score 20, MUCH LESS FREQUENTLY
            if (score >= 20) {
                let flyingMinSpacing = 900 + (gameSpeed * 80); // Much longer minimum spacing
                let flyingMaxSpacing = 1600 + (gameSpeed * 100); // Much longer maximum spacing
                let flyingRandomRange = Math.random() * (flyingMaxSpacing - flyingMinSpacing);
                let flyingTargetSpacing = flyingMinSpacing + flyingRandomRange;
                
                if (flyingBoxes.length === 0 || flyingBoxes[flyingBoxes.length - 1].x < canvas.width - flyingTargetSpacing) {
                    let boxLabels = ['Proposal', 'Midterm', 'Thesis', 'BTR Video'];
                    let randomLabel = boxLabels[Math.floor(Math.random() * boxLabels.length)];
                    
                    // Flying height adjusted to hit tassel when UP (not ducked)
                    let flyHeight = player.y - 20; // Higher so it hits the UP tassel position
                    
                    flyingBoxes.push({
                        x: canvas.width,
                        y: flyHeight,
                        width: 80,
                        height: 30,
                        label: randomLabel
                    });
                }
            }
            
            // Update and draw flying boxes
            for (let i = flyingBoxes.length - 1; i >= 0; i--) {
                let box = flyingBoxes[i];
                box.x -= gameSpeed * 1.3;
                
                // Draw the box
                ctx.fillStyle = '#FF6200';
                ctx.fillRect(box.x, box.y, box.width, box.height);
                ctx.strokeStyle = '#001C3D';
                ctx.lineWidth = 2;
                ctx.strokeRect(box.x, box.y, box.width, box.height);
                
                // Draw label
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(box.label, box.x + box.width/2, box.y + box.height/2 + 4);
                
                // Collision detection with TASSEL (only when tassel is UP)
                if (!player.ducking) {
                    // Check if tassel circle overlaps with box rectangle
                    if (tasselX + tasselRadius > box.x && 
                        tasselX - tasselRadius < box.x + box.width &&
                        tasselY + tasselRadius > box.y &&
                        tasselY - tasselRadius < box.y + box.height) {
                        gameOver();
                        return;
                    }
                }
                
                // Remove off-screen boxes
                if (box.x + box.width < 0) {
                    flyingBoxes.splice(i, 1);
                }
            }
            
            requestAnimationFrame(gameLoop);
        }

        function gameOver() {
            gameRunning = false;
            
            // Update high score
            if (score > highScore) {
                highScore = score;
                localStorage.setItem('btrHighScore', highScore);
                document.getElementById('highScore').textContent = highScore;
            }
            
            // Show game over message
            ctx.fillStyle = 'rgba(0, 28, 61, 0.85)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#fff';
            ctx.font = 'bold 48px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Thesis Submitted!', canvas.width / 2, canvas.height / 2 - 50);
            ctx.font = 'bold 28px Arial';
            ctx.fillStyle = '#00BCD4';
            ctx.fillText('Final Score: ' + score, canvas.width / 2, canvas.height / 2 + 10);
            
            if (score > highScore - 1) {
                ctx.fillStyle = '#E84E10';
                ctx.font = 'bold 24px Arial';
                ctx.fillText('ðŸŽ‰ NEW HIGH SCORE! ðŸŽ‰', canvas.width / 2, canvas.height / 2 + 55);
            }
            
            ctx.fillStyle = '#fff';
            ctx.font = '20px Arial';
            ctx.fillText('Press SPACE to play again', canvas.width / 2, canvas.height / 2 + 100);
            
            // Allow restart
            setTimeout(() => {
                const restartHandler = (e) => {
                    if (e.code === 'Space') {
                        document.removeEventListener('keydown', restartHandler);
                        startGame();
                    }
                };
                document.addEventListener('keydown', restartHandler);
            }, 500);
        }
    </script>
</body>
</html>




